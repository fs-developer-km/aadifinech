<div class="container">
  <!-- Enhanced Header Section -->
  <div class="content-wrapper" style="margin-top: 30px;">
    <div class="header">
      <div class="header-content">
        <div class="header-left">
          <div class="logo-section">
            <div class="header-text">
              <h1>Banking Lead Management System</h1>
              <p class="subtitle">Employee Dashboard - Manage Your Assigned Applications</p>
            </div>
          </div>
        </div>
        <div class="header-right">
          <div class="user-info">
            <span class="user-name">ğŸ‘¤ Employee Portal</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Compact Statistics Cards -->
  <div class="content-wrapper">
    <div class="stats-container">
      <div class="stat-card stat-total">
        <div class="stat-icon">ğŸ“Š</div>
        <div class="stat-info">
          <h3>{{ leads.length }}</h3>
          <p>Total Assigned</p>
        </div>
      </div>
      <div class="stat-card stat-pending">
        <div class="stat-icon">â³</div>
        <div class="stat-info">
          <h3>{{ getPendingCount() }}</h3>
          <p>Pending Review</p>
        </div>
      </div>
      <div class="stat-card stat-accepted">
        <div class="stat-icon">âœ…</div>
        <div class="stat-info">
          <h3>{{ getSuccessCount() }}</h3>
          <p>Success</p>
        </div>
      </div>
    </div>

    <!-- Filters and Search -->
    <div class="filters-section">
      <div class="search-box">
        <span class="search-icon">ğŸ”</span>
        <input type="text" [(ngModel)]="searchTerm" placeholder="Search by name, phone, source, notes..."
          class="search-input" />
      </div>

      <div class="filter-group">
        <label>Status:</label>
        <select [(ngModel)]="filterStatus" class="filter-select">
          <option value="All">All Applications</option>
          <option value="pending">Pending</option>
          <option value="success">Success</option>
        </select>
      </div>

      <button class="view-toggle-btn" (click)="toggleViewMode()" [title]="viewMode === 'grid' ? 'Switch to Table View' : 'Switch to Grid View'">
        <span *ngIf="viewMode === 'grid'">ğŸ“‹ Table View</span>
        <span *ngIf="viewMode === 'table'">ğŸ´ Grid View</span>
      </button>

      <button class="export-btn" (click)="exportToExcel()">
        ğŸ“¥ Export Excel
      </button>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-state">
      <div class="spinner"></div>
      <p>Loading leads...</p>
    </div>

    <!-- GRID VIEW - Compact Cards -->
    <div class="leads-grid" *ngIf="!loading && viewMode === 'grid'">
      <div class="lead-card-compact" *ngFor="let lead of getPaginatedLeads()" 
        [class.card-pending]="lead.status === 'pending'"
        [class.card-success]="lead.status === 'success'">

        <!-- Card Header -->
        <div class="card-header-compact">
          <div class="card-title-compact">
            <h3>{{ lead.leadName }}</h3>
            <span [class]="getStatusClass(lead.status || 'pending')" class="status-badge">
              {{ lead.status || 'pending' }}
            </span>
          </div>
          
          <div class="card-actions">
            <button class="btn-dropdown" (click)="toggleDropdown(lead._id, $event)" type="button" title="Actions">â‹®</button>

            <div class="dropdown-menu" *ngIf="openDropdownId === lead._id" [style.display]="openDropdownId === lead._id ? 'block' : 'none'">
              <button class="dropdown-item view-item" (click)="viewDetails(lead, $event); $event.stopPropagation()" type="button">
                <span class="item-icon">ğŸ‘ï¸</span>
                <span>View Details</span>
              </button>
              <button class="dropdown-item pending-item" (click)="updateToPending(lead, $event); $event.stopPropagation()" type="button">
                <span class="item-icon">â³</span>
                <span>Mark Pending</span>
              </button>
              <button class="dropdown-item success-item" (click)="updateToSuccess(lead, $event); $event.stopPropagation()" type="button">
                <span class="item-icon">âœ“</span>
                <span>Mark Success</span>
              </button>
            </div>
          </div>
        </div>

        <!-- Card Body Compact -->
        <div class="card-body-compact">
          <div class="info-row-compact">
            <span class="info-icon">ğŸ“±</span>
            <span class="info-text">{{ lead.leadPhone }}</span>
          </div>
          
          <div class="info-row-compact">
            <span class="info-icon">ğŸ“…</span>
            <span class="info-text">{{ lead.submittedDate }} â€¢ {{ lead.submittedTime }}</span>
          </div>
          
          <div class="info-row-compact">
            <span class="info-icon">ğŸŒ</span>
            <span class="info-text source-badge-inline">{{ lead.leadSource }}</span>
          </div>
          
          <div class="info-row-compact notes-row">
            <span class="info-icon">ğŸ“</span>
            <span class="info-text notes-text">{{ lead.notes }}</span>
          </div>
          
          <div class="info-row-compact">
            <span class="info-icon">ğŸ‘¤</span>
            <span class="info-text">{{ lead.assignTo.name }}</span>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="getPaginatedLeads().length === 0" class="empty-state">
        <div class="empty-icon">ğŸ“­</div>
        <h3>No leads found</h3>
        <p>Try adjusting your filters or search criteria</p>
      </div>
    </div>

    <!-- TABLE VIEW -->
    <div class="table-container" *ngIf="!loading && viewMode === 'table'">
      <div class="table-responsive">
        <table class="leads-table">
          <thead>
            <tr>
              <th>Lead Name</th>
              <th>Phone</th>
              <th>Date & Time</th>
              <th>Source</th>
              <th>Notes</th>
              <th>Assigned To</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let lead of getPaginatedLeads()" 
              [class.row-pending]="lead.status === 'pending'"
              [class.row-success]="lead.status === 'success'">
              <td class="td-name">{{ lead.leadName }}</td>
              <td>{{ lead.leadPhone }}</td>
              <td class="td-datetime">
                <div>{{ lead.submittedDate }}</div>
                <div class="time-text">{{ lead.submittedTime }}</div>
              </td>
              <td><span class="source-badge-table">{{ lead.leadSource }}</span></td>
              <td class="td-notes">{{ lead.notes }}</td>
              <td>
                <div>{{ lead.assignTo.name }}</div>
                <div class="mobile-text">{{ lead.assignTo.mobile }}</div>
              </td>
              <td>
                <span [class]="getStatusClass(lead.status || 'pending')" class="status-badge">
                  {{ lead.status || 'pending' }}
                </span>
              </td>
              <td class="td-actions">
                <div class="table-actions">
                  <button class="btn-table-action btn-view" (click)="viewDetails(lead)" title="View Details">ğŸ‘ï¸</button>
                  <button class="btn-table-action btn-pending" (click)="updateToPending(lead, $event)" title="Mark Pending">â³</button>
                  <button class="btn-table-action btn-success" (click)="updateToSuccess(lead, $event)" title="Mark Success">âœ“</button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Empty State for Table -->
      <div *ngIf="getPaginatedLeads().length === 0" class="empty-state">
        <div class="empty-icon">ğŸ“­</div>
        <h3>No leads found</h3>
        <p>Try adjusting your filters or search criteria</p>
      </div>
    </div>

    <!-- Pagination -->
    <div class="pagination" *ngIf="getTotalPages() > 1 && !loading">
      <button class="page-btn" (click)="goToPage(currentPage - 1)" [disabled]="currentPage === 1">
        â€¹ Previous
      </button>

      <button *ngFor="let page of getPageNumbers()" class="page-number" [class.active]="page === currentPage"
        [class.ellipsis]="page === -1" (click)="page !== -1 && goToPage(page)" [disabled]="page === -1">
        {{ page === -1 ? '...' : page }}
      </button>

      <button class="page-btn" (click)="goToPage(currentPage + 1)" [disabled]="currentPage === getTotalPages()">
        Next â€º
      </button>
    </div>
  </div>

  <!-- Details Modal -->
  <div *ngIf="showDetailsModal" class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <div>
          <h2>Lead Details</h2>
          <span class="modal-subtitle">Complete lead information</span>
        </div>
        <button class="close-btn" (click)="closeModal()">âœ•</button>
      </div>

      <div class="modal-body" *ngIf="selectedLead">
        <div class="detail-section">
          <h4>ğŸ“‹ Lead Information</h4>
          <div class="detail-grid">
            <div class="detail-item">
              <span class="detail-label">Lead Name</span>
              <span class="detail-value">{{ selectedLead.leadName }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Phone Number</span>
              <span class="detail-value">{{ selectedLead.leadPhone }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Submitted Date</span>
              <span class="detail-value">{{ selectedLead.submittedDate }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Submitted Time</span>
              <span class="detail-value">{{ selectedLead.submittedTime }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Source</span>
              <span class="detail-value">{{ selectedLead.leadSource }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Current Status</span>
              <span [class]="getStatusClass(selectedLead.status || 'pending')" class="status-badge">
                {{ selectedLead.status || 'pending' }}
              </span>
            </div>
          </div>
        </div>

        <div class="detail-section">
          <h4>ğŸ“ Notes</h4>
          <div class="detail-grid">
            <div class="detail-item full-width">
              <span class="detail-label">Notes</span>
              <span class="detail-value">{{ selectedLead.notes }}</span>
            </div>
          </div>
        </div>

        <div class="detail-section">
          <h4>ğŸ‘¥ Assignment Details</h4>
          <div class="detail-grid">
            <div class="detail-item">
              <span class="detail-label">Assigned To</span>
              <span class="detail-value">{{ selectedLead.assignTo.name }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Assigned Mobile</span>
              <span class="detail-value">{{ selectedLead.assignTo.mobile }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Assigned ID</span>
              <span class="detail-value">{{ selectedLead.assignTo._id }}</span>
            </div>
          </div>
        </div>

        <div class="detail-section">
          <h4>ğŸ• Timestamps</h4>
          <div class="detail-grid">
            <div class="detail-item">
              <span class="detail-label">Created At</span>
              <span class="detail-value">{{ selectedLead.createdAt | date:'dd MMM yyyy, hh:mm a' }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Updated At</span>
              <span class="detail-value">{{ selectedLead.updatedAt | date:'dd MMM yyyy, hh:mm a' }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Confirmation Modal -->
  <div *ngIf="showConfirmModal" class="modal-overlay confirm-overlay" (click)="closeConfirmModal()">
    <div class="confirm-modal" (click)="$event.stopPropagation()">
      <div class="confirm-icon" [class.pending-icon]="confirmAction === 'pending'" 
           [class.success-icon]="confirmAction === 'success'">
        <span *ngIf="confirmAction === 'pending'">â³</span>
        <span *ngIf="confirmAction === 'success'">âœ“</span>
      </div>
      
      <h3 class="confirm-title">Confirm Status Change</h3>
      
      <p class="confirm-message" *ngIf="confirmLead">
        Are you sure you want to mark <strong>{{ confirmLead.leadName }}</strong>'s status as 
        <span [class.text-pending]="confirmAction === 'pending'" 
              [class.text-success]="confirmAction === 'success'">
          {{ confirmAction }}
        </span>?
      </p>
      
      <div class="confirm-actions">
        <button class="confirm-btn cancel-btn" (click)="closeConfirmModal()">
          <span>âœ•</span> Cancel
        </button>
        <button class="confirm-btn" 
                [class.pending-btn]="confirmAction === 'pending'"
                [class.success-btn]="confirmAction === 'success'"
                (click)="confirmStatusUpdate()">
          <span *ngIf="confirmAction === 'pending'">â³</span>
          <span *ngIf="confirmAction === 'success'">âœ“</span>
          Confirm
        </button>
      </div>
    </div>
  </div>
</div>