<div class="dashboard-container mt-3">
  <!-- Header Section -->
  <div class="dashboard-header">
    <div class="employee-info">
      <div class="avatar">{{ employeeName.charAt(0) }}</div>
      <div class="info">
        <!-- <h1>Welcome, {{ employeeName }}!</h1>
        <p>Employee ID: {{ employeeId }}</p> -->

        <div style="font-size: 20px; font-family: Arial, Helvetica, sans-serif;"> Welcome {{ authService.getUser()?.name }}</div>
        <div style="font-size: 15px; font-family: Arial, Helvetica, sans-serif;">{{ userRole | titlecase }}</div>

      </div>
    </div>
    <div class="date-info">
      <p class="current-date" style="color: #fff;">{{ currentMonth }}</p>
    </div>
  </div>

  <!-- Stats Overview -->
  <div class="stats-grid">
    <!-- Lead Stats -->
    <div class="stat-card stat-primary">
      <div class="stat-icon">üìä</div>
      <div class="stat-content">
       <h3>{{ leads.length }}</h3>
          <p>Total Assigned</p>
      </div>
    </div>
    
    <div class="stat-card stat-success">
      <div class="stat-icon">‚úÖ</div>
      <div class="stat-content">
        <h3>{{ getSuccessCount() }}</h3>
          <p>Success</p>
      </div>
    </div>
    
    <div class="stat-card stat-warning">
      <div class="stat-icon">‚è≥</div>
      <div class="stat-content">
        <h3>{{ getPendingCount() }}</h3>
          <p>Pending Review</p>
      </div>
    </div>
    
    <!-- <div class="stat-card stat-danger">
      <div class="stat-icon">‚ùå</div>
      <div class="stat-content">
        <h3>{{ failedLeads }}</h3>
        <p>Failed Leads</p>
      </div>
    </div> -->
  </div>

  <!-- Main Content Grid -->
<!-- LEAD MANAGEMENT TABLE -->
<div class="section-card">
  <div class="section-header">
    <h2>üìã Lead Management</h2>
    <div class="success-rate">
      <span class="rate-badge">{{ successRate }}% Success Rate</span>
    </div>
  </div>
  
  <div class="table-container">
    <table class="data-table">
      <thead>
        <tr>
          <th>Customer Name</th>
          <th>Mobile</th>
          <th>Assigned Date</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let lead of leads">
          <td data-label="Customer Name">
            <div class="customer-name">{{ lead.leadName }}</div>
          </td>
          <td data-label="Mobile">
            <span class="value-amount">{{ lead.leadPhone }}</span>
          </td>
          <td data-label="Assigned Date">{{ lead.submittedDate }}</td>
          <td data-label="Status">
            <span [class]="'status-badge ' + getStatusBadgeClass(lead.status)">
              {{ getStatusText(lead.status) }}
            </span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- ATTENDANCE TABLE -->
<div class="section-card">
  <div class="section-header">
    <h2>üìÖ Attendance Record</h2>
    <div class="attendance-rate">
      <span class="rate-badge">{{ attendancePercentage }}% Attendance</span>
    </div>
  </div>

  <!-- Month/Year Selector -->
  <div class="month-year-selector">
    <select [(ngModel)]="selectedMonth" (change)="loadAttendanceData()" class="month-dropdown">
      <option *ngFor="let month of months" [value]="month.value">{{ month.label }}</option>
    </select>
    <select [(ngModel)]="selectedYear" (change)="loadAttendanceData()" class="year-dropdown">
      <option *ngFor="let year of years" [value]="year">{{ year }}</option>
    </select>
    <button (click)="loadAttendanceData()" class="refresh-button">üîÑ</button>
  </div>

  <!-- Loading/Error States -->
  <div *ngIf="attendanceLoading" class="loading-wrapper">
    <div class="loading-spinner"></div>
    <p>Loading attendance...</p>
  </div>

  <div *ngIf="attendanceError && !attendanceLoading" class="error-wrapper">
    <p>‚ùå {{ attendanceError }}</p>
    <button (click)="loadAttendanceData()" class="retry-button">Try Again</button>
  </div>

  <!-- Attendance Content -->
  <div *ngIf="!attendanceLoading && !attendanceError">
    
    <!-- Attendance Stats -->
    <div class="attendance-stats">
      <div class="attendance-stat">
        <div class="stat-label">Present</div>
        <div class="stat-value present">{{ presentDays }}/{{ totalWorkingDays }}</div>
      </div>
      <div class="attendance-stat">
        <div class="stat-label">Absent</div>
        <div class="stat-value absent">{{ absentDays }}</div>
      </div>
      <div class="attendance-stat">
        <div class="stat-label">Half Day</div>
        <div class="stat-value halfday">{{ halfDays }}</div>
      </div>
      <div class="attendance-stat" *ngIf="monthlySummary">
        <div class="stat-label">Late Arrivals</div>
        <div class="stat-value late-text">{{ monthlySummary.totalLate }}</div>
      </div>
      <div class="attendance-stat" *ngIf="monthlySummary">
        <div class="stat-label">Avg Hours</div>
        <div class="stat-value avg-hours">{{ monthlySummary.averageWorkHours }}h</div>
      </div>
    </div>

    <!-- Attendance Table -->
    <div class="table-container">
      <table class="data-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Check In</th>
            <th>Check Out</th>
            <th>Duration</th>
            <th>Status</th>
            <th>Notes</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let attendance of attendanceRecords">
            <td data-label="Date">
              <strong>{{ formatDate(attendance.date) }}</strong>
            </td>
            <td data-label="Check In">
              <span class="time" [class.late-time]="attendance.isLate">
                {{ formatTime(attendance.checkInTime) }}
                <span *ngIf="attendance.isLate" class="late-indicator">‚ö†Ô∏è</span>
              </span>
            </td>
            <td data-label="Check Out">
              <span class="time" [class.early-time]="attendance.isEarlyOut">
                {{ formatTime(attendance.checkOutTime) }}
                <span *ngIf="attendance.isEarlyOut" class="early-indicator">üèÉ</span>
              </span>
            </td>
            <td data-label="Duration">
              <span class="duration-text">{{ formatWorkDuration(attendance.workDuration) }}</span>
            </td>
            <td data-label="Status">
              <span [class]="'status-badge ' + getStatusBadgeClass(attendance.status)">
                {{ getStatusText(attendance.status) }}
              </span>
            </td>
            <td data-label="Notes">
              <div class="notes-cell">
                <span *ngIf="attendance.isLate" class="note-late">
                  Late by {{ attendance.lateByMinutes }} min
                </span>
                <span *ngIf="attendance.isEarlyOut" class="note-early">
                  Early by {{ attendance.earlyOutByMinutes }} min
                </span>
                <span *ngIf="!attendance.isLate && !attendance.isEarlyOut && attendance.checkOutTime" class="note-ontime">
                  ‚úì On Time
                </span>
              </div>
            </td>
          </tr>

          <!-- Empty State -->
          <tr *ngIf="attendanceRecords.length === 0">
            <td colspan="6" class="empty-row">
              <p>üì≠ No attendance records found for this month</p>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="pagination-wrapper" *ngIf="attendanceTotalPages > 1">
      <button (click)="previousAttendancePage()" [disabled]="attendanceCurrentPage === 1" class="page-button">
        ‚Üê Prev
      </button>
      <span class="page-info">
        Page {{ attendanceCurrentPage }} of {{ attendanceTotalPages }}
      </span>
      <button (click)="nextAttendancePage()" [disabled]="attendanceCurrentPage === attendanceTotalPages" class="page-button">
        Next ‚Üí
      </button>
    </div>

  </div>
</div>
</div>